<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Login</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 2rem; max-width: 400px; margin: auto; }
    label { display: block; margin-top: 1rem; }
    input, button { width: 100%; padding: 0.5rem; margin-top: 0.3rem; }
    button { margin-top: 1.5rem; }
    .message { margin-top: 1rem; }
  </style>
</head>
<body>
  <h1>Login</h1>
  <form id="login-form">
    <label>
      Usuário:
      <input type="text" name="username" required />
    </label>
    <label>
      Senha:
      <input type="password" name="password" required />
    </label>
    <button type="submit">Entrar</button>
  </form>

  <div class="message" id="message"></div>

  <script>
    const form = document.getElementById('login-form');
    const messageEl = document.getElementById('message');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      messageEl.textContent = '';

      const formData = new FormData(form);
      const data = Object.fromEntries(formData.entries());

      try {
        const response = await fetch('http://localhost:8000/api/auth/login/', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data),
        });

        if (response.ok) {
          const json = await response.json();
          localStorage.setItem('access_token', json.access);
          localStorage.setItem('refresh_token', json.refresh);
          messageEl.style.color = 'green';
          messageEl.textContent = 'Login realizado com sucesso!';

          // Verifica tipo de usuário e redireciona
          const userTypeRes = await fetch('http://localhost:8000/api/auth/user-type/', {
            method: 'GET',
            headers: {
              'Authorization': 'Bearer ' + json.access,
            }
          });

          const userTypeData = await userTypeRes.json();
          const groups = userTypeData.groups;

          setTimeout(() => {
            if (groups.includes('owners')) {
              window.location.href = '../dashboards/owner.html';
            } else {
              window.location.href = '../reservations/create.html';
            }
          }, 1500);

        } else {
          const errorData = await response.json();
          messageEl.style.color = 'red';
          messageEl.textContent = 'Erro: ' + JSON.stringify(errorData);
        }
      } catch (error) {
        messageEl.style.color = 'red';
        messageEl.textContent = 'Erro na conexão com o servidor.';
      }
    });
  </script>
</body>
</html>
<!-- This is the login page for the application. It allows users to log in with their username and password.
     Upon successful login, it stores the access and refresh tokens in local storage and redirects users based on their group type. -->