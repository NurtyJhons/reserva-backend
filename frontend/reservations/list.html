<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Minhas Reservas</title>
</head>
<body>
  <h2>Minhas Reservas</h2>
  <ul id="reservationsList"></ul>

  <script>

    const API_BASE_URL = 'http://localhost:8000/api/';
    
    if (!localStorage.getItem('access_token')) {
      alert('Você precisa estar logado para ver suas reservas.');
      window.location.href = '/frontend/login.html';
    }

    document.addEventListener('DOMContentLoaded', async () => {
      const token = localStorage.getItem('access_token');
      const res = await fetch(`${API_BASE_URL}reservations/`, {
        headers: { 'Authorization': `Bearer ${token}` }
      });
      const reservations = await res.json();

      const list = document.getElementById('reservationsList');
      reservations.forEach(r => {
        const li = document.createElement('li');
        li.innerHTML = `
          <strong>${r.location_name}</strong><br>
          Data: ${r.date}<br>
          Horário: ${r.start_time} - ${r.end_time}<br>
          Status: ${r.status}
          ${r.status === 'confirmed' ? `<button onclick="cancelReservation(${r.id})">Cancelar</button>` : ''}
        `;
        list.appendChild(li);
      });
    });

    async function cancelReservation(id) {
      const token = localStorage.getItem('access_token');
      const res = await fetch(`${API_BASE_URL}reservations/${id}/cancel/`, {
        method: 'PATCH',
        headers: { 'Authorization': `Bearer ${token}` }
      });

      if (res.ok) {
        alert('Reserva cancelada com sucesso!');
        location.reload();
      } else {
        const err = await res.json();
        alert('Erro ao cancelar: ' + (err.detail || JSON.stringify(err)));
      }
    }
  </script>
</body>
</html>
