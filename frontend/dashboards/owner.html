<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Dashboard do Owner</title>
</head>
<body>
  <div class="container">
    <h1>Dashboard do Owner</h1>

    <div id="stats">
      <p><strong>Total de Locais:</strong> <span id="totalLocations">...</span></p>
      <p><strong>Total de Reservas:</strong> <span id="totalReservations">...</span></p>
      <p><strongReservas Futuras:</strong> <span id="upcomingReservations">...</span></p>
    </div>

    <h2>Reservas por Local</h2>
    <ul id="reservationsPerLocation"></ul>

    <a href="../locations/create.html">+ Cadastrar Novo Local</a>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", async () => {
      const token = localStorage.getItem("access_token");
      
      if (!token) {
        alert("VocÃª precisa estar logado.");
        window.location.href = "../login.html";
        return;
      }

      const response = await fetch("http://localhost:8000/api/owner/dashboard/", {
        headers: {
          Authorization: `Bearer ${token}`
        }
      });

      if (response.ok) {
        const data = await response.json();
        document.getElementById("totalLocations").textContent = data.total_locations;
        document.getElementById("totalReservations").textContent = data.total_reservations;
        document.getElementById("upcomingReservations").textContent = data.upcoming_reservations;

        const list = document.getElementById("reservationsPerLocation");
        data.reservations_per_location.forEach(item => {
          const li = document.createElement("li");
          li.textContent = `${item.location__name}: ${item.count} reservas`;
          list.appendChild(li);
        });
      } else {
        alert("Erro ao carregar dados do dashboard");
      }
    });
  </script>
</body>
</html>
